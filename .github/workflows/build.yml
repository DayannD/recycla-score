name: Recycla-score backend build

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:
  build:

    runs-on: ubuntu-latest

    services:
      mysql:
        image: "mysql:8.0"
        env:
          MYSQL_ROOT_PASSWORD: '01234'
          MYSQL_DATABASE: 'recycla-score'
        volumes:
          - db:/var/lib/mysql
          - ./init-db.sql:/docker-entrypoint-initdb.d/init-db.sql
        ports:
          - 3306:3306

    steps:
    - uses: actions/checkout@v3
    - name: Set up JDK 17
      uses: actions/setup-java@v3
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: maven
    - name: Cache Maven packages
      uses: actions/cache@v2
      with:
       path: ~/.m2
       key: ${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}
       restore-keys: ${{ runner.os }}-m2
    - name: Build with Maven
      run: mvn -B package --file pom.xml
